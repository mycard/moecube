version: '{build}'

platform: x86

environment:
  priv_key:
    secure: ek1AH0N8/KF6VoildmkHnu4TY1yBZcptm20AesAOanRSSGLFqkXeRxL80mHSXtiVY8ggtQNsEQR4M69gCiw1OPVWz4OAN6Vg6id6kho9GqYxWCdADbmffSNPB5leksRGjGmkAF99WHiOIZrLRUb6Bia91Fe5+SngPhI01GDDUZA2urv9x50uBBhc+kvV0bv7J5TeXDGr7tfZ3J2aL/3tf/WPqBkqjWlGAj99HTWpkIiQgwaBHoyBvEFD0uHa1BdSmI7PySGabbx4/4zqyGkO38Ce7t/Ntu/dgedzVxlXYfuiXDI8caAPZSVsJ9E2S3VKesZJzHtV9KM/8Xq0RFPythdC/qTvd2e3IAZGudZpgbUHGAHLJnCzn189Zm+Qle8CbbVuPNDcf1B/G/XwEU2MsDXGkF/kFxdeqbHgjzneyns=
  BT_TOKEN:
    secure: VNRwtuHDHJQS0UbCW2WmNSyyRtKhYPC5FCZztllsIygyg3dj5H/YY89UUmPW9vU7
  GH_TOKEN:
    secure: itZ9Z1dxEpfPJLdTs/PiY98pVZ3GCLNWfid7eAu7SL88Jl9AIrf/3rviKFEbsnoY
  CSC_LINK:
    secure: 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
#  npm_config_target: 1.4.10 # 在下面 install 里动态获取
  npm_config_arch: ia32
  npm_config_target_arch: ia32
  npm_config_disturl: https://atom.io/download/atom-shell
  npm_config_runtime: electron
  npm_config_build_from_source: true

cache:
  - node_modules -> package.json
  - '%APPDATA%\npm-cache -> package.json'
  - '%USERPROFILE%\.electron -> package.json'

shallow_clone: true

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  - ps: $fileContent = "-----BEGIN EC PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END EC PRIVATE KEY-----`n"
  - ps: Set-Content c:\users\appveyor\.ssh\id_ecdsa $fileContent

on_finish:
  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - set PATH=%PATH%;C:\MinGW\msys\1.0\bin;C:\Program Files\Git\mingw64\bin # tar xz
  - mkdir -p bin
  - curl --location --retry 5 --output aria2-1.29.0-win-32bit-build1.zip https://github.com/aria2/aria2/releases/download/release-1.29.0/aria2-1.29.0-win-32bit-build1.zip
  - unzip -o aria2-1.29.0-win-32bit-build1.zip aria2-1.29.0-win-32bit-build1/aria2c.exe
  - mv aria2-1.29.0-win-32bit-build1/aria2c.exe bin
  - rm -rf aria2-1.29.0-win-32bit-build1 aria2-1.29.0-win-32bit-build1.zip
  - curl --location --retry 5 'http://downloads.sourceforge.net/project/msys2/REPOS/MSYS2/i686/bsdtar-3.2.1-1-i686.pkg.tar.xz' | tar --strip-components=2 -C bin -Jxf - usr/bin/bsdtar.exe
  - curl --location --retry 5 'http://downloads.sourceforge.net/project/msys2/Base/i686/msys2-base-i686-20161025.tar.xz' | tar --strip-components=3 -C bin -Jxf - msys32/usr/bin/msys-2.0.dll msys32/usr/bin/msys-bz2-1.dll msys32/usr/bin/msys-gcc_s-1.dll msys32/usr/bin/msys-iconv-2.dll msys32/usr/bin/msys-lzma-5.dll msys32/usr/bin/msys-lzo2-2.dll msys32/usr/bin/msys-nettle-6.dll msys32/usr/bin/msys-xml2-2.dll msys32/usr/bin/msys-z.dll msys32/usr/bin/sha256sum.exe msys32/usr/bin/msys-intl-8.dll

  - ps: Install-Product node
  - npm show electron version > %temp%\electron-version.txt
  - set /p npm_config_target= < %temp%\electron-version.txt
  - npm install
  - npm prune

build_script:
  - npm run dist
